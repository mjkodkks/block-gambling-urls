name: Validate PR

on:
  pull_request:
    paths:
      - 'block_url.txt'

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate Adblock Plus format
        run: |
          # Check if file starts with [Adblock Plus 2.0]
          if ! head -n 1 block_url.txt | grep -q "^\[Adblock Plus"; then
            echo "❌ Error: File must start with [Adblock Plus] header"
            exit 1
          fi
          
          # Check for required metadata
          if ! grep -q "^! Title:" block_url.txt; then
            echo "⚠️ Warning: Missing Title metadata"
          fi
          
          if ! grep -q "^! Version:" block_url.txt; then
            echo "❌ Error: Missing Version metadata"
            exit 1
          fi
          
          if ! grep -q "^! Homepage:" block_url.txt; then
            echo "⚠️ Warning: Missing Homepage metadata"
          fi
          
          echo "✅ Blocklist format validation passed"

      - name: Check for syntax errors
        run: |
          # Count valid filter rules (excluding comments and empty lines)
          FILTER_COUNT=$(grep -v "^!" block_url.txt | grep -v "^\[Adblock" | grep -v "^$" | wc -l)
          echo "Found $FILTER_COUNT filter rules"
          
          if [ "$FILTER_COUNT" -eq 0 ]; then
            echo "⚠️ Warning: No filter rules found"
          else
            echo "✅ Filter rules found: $FILTER_COUNT"
          fi
